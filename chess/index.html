<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>chess♕</title>
<link rel="stylesheet" href="chess_files/chess.css"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../../boukew99.css"> 
<link rel="icon" type="image/x-icon" href="../../favicon.ico">
<style>
	#chessboard td {
	width: 40px;
	height: 40px;
	padding: 5px;
	text-align: center;
	font-size: 30px;
	user-select: none;
	}
	/*https://stackoverflow.com/questions/35802488/chessboard-style-for-a-table-with-css-how*/
	#chessboard tr:nth-child(even) td:nth-child(even), tr:nth-child(odd) td:nth-child(odd) {
	background: grey;
	}
	#chessboard tr:nth-child(odd) td:nth-child(even), tr:nth-child(even) td:nth-child(odd) {
	background: white;
	}

	fieldset {
		/*columns:8;*/
		column-width:5em;
	}
</style>
</head><body><header>
<h1>Chess</h1>
<p>Chess <a href="https://en.wikipedia.org/wiki/Chess#Rules">rules</a></p>
<h2>Instructions</h2>
<ol>
	<li>Fill in your player-name in the form below</li>
	<li>Make your move.</li>
	<li>Share that URL with an opponent</li>
</ol>
</header>
<main>
<h2>Game</h2>
<form>
	<fieldset id=versus>
		<legend>versus</legend>
		<label>Black:
			<input id=black type=text name=b disabled>
		</label><br><br> <!-- fieldset-columns-->
		<label>White:
			<input id=white type=text name=w disabled>
		</label>
	</fieldset>

	<table id="chessboard" cellspacing="0" border="5">
		<caption>Chess board</caption>  
		<tbody><tr>
			<th></th>
		  <th>8</th>
		  <th>7</th>
		  <th>6</th>
		  <th>5</th>
		  <th>4</th>
		  <th>3</th>
		  <th>2</th>
		  <th>1</th>
		</tr>
		<tr>
		  <th>H</th>
		  <td id="h8"></td>
		  <td id="h7"></td>
		  <td id="h6"></td>
		  <td id="h5"></td>
		  <td id="h4"></td>
		  <td id="h3"></td>
		  <td id="h2"></td>
		  <td id="h1"></td>
		  <th>H</th>
		</tr>
		<tr>
		  <th>G</th>
			<td id="g8"></td>
		  <td id="g7"></td>
		  <td id="g6"></td>
		  <td id="g5"></td>
		  <td id="g4"></td>
		  <td id="g3"></td>
		  <td id="g2"></td>
		  <td id="g1"></td>
		  <th>G</th>
		</tr>
		<tr>
		  <th>F</th>
		  <td id="f8"></td>
		  <td id="f7"></td>
		  <td id="f6"></td>
		  <td id="f5"></td>
		  <td id="f4"></td>
		  <td id="f3"></td>
		  <td id="f2"></td>
		  <td id="f1"></td>
		  <th>F</th>
		</tr>
		<tr>
		  <th>E</th>
		  <td id="e8"></td>
		  <td id="e7"></td>
		  <td id="e6"></td>
		  <td id="e5"></td>
		  <td id="e4"></td>
		  <td id="e3"></td>
		  <td id="e2"></td>
		  <td id="e1"></td>
		  <th>E</th>
		</tr>
		<tr>
		  <th>D</th>
		  <td id="d8"></td>
		  <td id="d7"></td>
		  <td id="d6"></td>
		  <td id="d5"></td>
		  <td id="d4"></td>
		  <td id="d3"></td>
		  <td id="d2"></td>
		  <td id="d1"></td>
		  <th>D</th>
		</tr>
		<tr>
		  <th>C</th>
		  <td id="c8"></td>
		  <td id="c7"></td>
		  <td id="c6"></td>
		  <td id="c5"></td>
		  <td id="c4"></td>
		  <td id="c3"></td>
		  <td id="c2"></td>
		  <td id="c1"></td>
		  <th>C</th>
		
		</tr><tr>
			<th>B</th>
		  <td id="b8"></td>
		  <td id="b7"></td>
		  <td id="b6"></td>
		  <td id="b5"></td>
		  <td id="b4"></td>
		  <td id="b3"></td>
		  <td id="b2"></td>
		  <td id="b1="></td>
		  <th>B</th>
		</tr>
		<tr>
			<th>A</th>
		  <td id="a8"></td>
		  <td id="a7"></td>
		  <td id="a6"></td>
		  <td id="a5"></td>
		  <td id="a4"></td>
		  <td id="a3"></td>
		  <td id="a2"></td>
		  <td id="a1"></td>
		  <th>A</th>
		</tr>  
		<tr>
			<th></th>
		  <th>8</th>
		  <th>7</th>
		  <th>6</th>
		  <th>5</th>
		  <th>4</th>
		  <th>3</th>
		  <th>2</th>
		  <th>1</th>
		</tr>
	</tbody></table>
	<p id="bench"></p>

	<fieldset>
		<legend>choose move</legend>
		<label>♖A1-A2
			<input type=radio name=move value=A1-A2>
		</label><label>♖A1-A3
			<input type=radio name=move>
		</label><label>♖A1-A4
			<input type=radio name=move>
		</label><label>♖A1-A5
			<input type=radio name=move>
		</label><label>♖A1-A6
			<input type=radio name=move>
		</label><label>♖A1-A7
			<input type=radio name=move>
		</label><label>♖A1-A8
			<input type=radio name=move>
		</label>
		<label>A2-A2
			<input type=radio name=move>
		</label><label>A2-A3
			<input type=radio name=move>
		</label><label>A2-A4
			<input type=radio name=move>
		</label><label>A2-A5
			<input type=radio name=move>
		</label><label>A2-A6
			<input type=radio name=move>
		</label><label>A2-A7
			<input type=radio name=move>
		</label><label>A2-A8
			<input type=radio name=move>
		</label>
	</fieldset>

	<input type="submit" value="Set Move">	
</form>
<h2>Chess puzzles</h2>
<table>
<caption>puzzels</caption>
<tr>
<th>Name</th>
<th>Difficulty</th>
<th>Setup</th>
</tr>
<tr>
<td>Rowing</td>
<td>⭐️⭐️⭐️⭐️</td>
<td><a href="game.html?setup=5r2/8/1R6/ppk3p1/2N3P1/P4b2/1K6/5B2">5r2/8/1R6/ppk3p1/2N3P1/P4b2/1K6/5B2</a></td>
</tr>
<tr>
<td>Switch</td>
<td>⭐️⭐️⭐️⭐️</td>
<td><a href="game.html?setup=5♖2/8/1♜6/♙♙♕3♙1/2♞3♟1/♟4♗2/1♚6/5♝2">5♖2/8/1♜6/♙♙♕3♙1/2♞3♟1/♟4♗2/1♚6/5♝2</a></td>
</tr>
</table>

<h2>Make your own</h2>
<form action=../chess.html>
<!--https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/search-->
	<label for="setup">or put in a custom setup with FEN+ code:</label>
	<input size=64 type=search id="setup" name="setup" maxlength=64>
</form>

</main>
<footer>
  <p>© 2022 boukew99 <img src=favicon.ico></p>
	<p><a href=puzzles.html>puzzles</a>, training(Todo)</p>
</footer>
<script>
//https://www.w3docs.com/snippets/javascript/how-to-get-url-parameters.html
//https://stackoverflow.com/questions/3065342/how-do-i-iterate-through-table-rows-and-cells-in-javascript

//♖♙4♟♜♘♙4♟♞♗♙4♟♝♕♙4♟♛♔♙4♟♚♗♙4♟♝♘♙4♟♞♖♙4♟♜ viewers angle
//rp4PR/np4PN/bp4PB/qp4PQ/kp4PK/bp4PB/np4PN/rp4PR Inversed

window.addEventListener('load', (event) => {
	const urlParams = new URLSearchParams(window.location.search);
	let white = 'w' in urlParams
	let black = 'b' in urlParams
	
	let gameKey = urlParams.get("vs")
	//let opponent = getChessColor(move)
	
	if (urlParams.has('w')){
		document.getElementById("white").value = urlParams.get('w');
	}	
	else { 
		document.getElementById("white").disabled = false;
		}
	if (urlParams.has('b')){
		document.getElementById("black").value = urlParams.get('b');
		}
	else {
		document.getElementById("black").disabled = false;
	}
		
	let setup = localStorage.getItem("opponent")
	if (setup) {
		//localStorage.setItem(opponent, setup)
	}
	else {
		setup = "rnbkqbnrpppppppp8888PPPPPPPPRNBKQBNR"
		//localStorage.setItem(w+b, setup)
	}
	
	setupBoard(setup)
	
	const move = urlParams.get('move')
});


function char2piece(character) {
	switch (character) {
		case "k":	return "♚";
		case "K": return "♔";
		case "q": return "♛"
		case "Q": return "♕"
		case "b": return "♝"
		case "B": return "♗"
		case "n": return "♞"
		case "N": return "♘"
		case "r": return "♜"
		case "R": return "♖"
		case "p": return "♟"
		case "P": return "♙"
		default: return character
	}
}


function validate_move(piece, from, to) {
	switch (piece) {
		case "♜", "♖", "n", "N":
			break
		case "♟", "P":
		  alert("pawns can only move forward and capture diagonally.")
		  return true
		case "♙", "p":
			break
	}
}


function setupBoard(fen2, side=false) {
		const setup =  fen2.split("");
		const cells = document.getElementsByTagName("td") 
		const bench = "♖♘♗♔♕♗♘♖♙♙♙♙♙♙♙♙♟♟♟♟♟♟♟♟♜♞♝♚♛♝♞♜".split("")
		
		for (let i = 0; i < 64;i=i) {
			var cell = cells[i];
			var character = setup.shift();
			if (!isNaN(character)) {
				i += parseInt(character);
			}	else if (character == "/"){
				if (i%8==0) {i=i}
				else { i += (8 - i % 8) }
			} else {				
			
				icon = char2piece(character)
				cell.innerHTML = (icon) ? icon : "";
				if (icon) {bench.splice(bench.indexOf(icon), 1)}
				
				if (character == character.toLowerCase() == side) {
					
					var opt = document.createElement('option');
					opt.value = i;
					opt.innerHTML = String.fromCharCode(97 + 8 - Math.trunc((i/8+1))).toUpperCase() + (i%8 +1) + icon;
					//select.appendChild(opt);
				}
				
				i++;
				}
			}
		document.getElementById("bench").innerHTML = bench.join("")
		const to = document.getElementById("to")
		for (let i = 1; i < 9;i+=1) {
			for (let j = 0; j < 8; j+=1) {
				const opt = document.createElement('option');
				opt.value = i;
				opt.innerHTML = String.fromCharCode(97 + j).toUpperCase() + i
				//to.appendChild(opt)	
			}
		}
}

function get_knight_moves(position) {
	// L shape moves in all directions and mirrors
	var moves = Array(8)
	moves[0] = position +2 -8
	moves[1] = position +2 +8
	moves[2] = position -2 -8
	moves[3] = position -2 +8
	moves[4] = position -8 +1 
	moves[5] = position -8 -1
	moves[6] = position +8 +1
	moves[7] = position +8 -1
	moves.filter(n => n > 0 && n < 64) // in bounds
}

function get_pawn_moves(position, side){
	var moves = Array(3)
	moves[0] = position + 8 * side
	if ( (position in [8,9,10,11,12,13,14,15] && side == 1) || (position in [48,49,50,51,52,53,54,55] && side == -1) ) {
		moves [1] = position + 16 * side
	}
	//if (pieceOnDiagnol or pawnPassed) moves[2] = position + 9/7 * side
}
function in_bounds(array) {
	return moves.filter(n => n > 0 && n < 64)
}

//https://www.chessprogramming.org/Simplified_Evaluation_Function
</script>
</body></html>
